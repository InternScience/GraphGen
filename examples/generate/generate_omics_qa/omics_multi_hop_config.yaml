global_params:
  working_dir: cache

nodes:
  - id: read_files
    op_name: read
    type: source
    dependencies: []
    params:
        input_path:
          - examples/input_examples/search_dna_demo.jsonl  # Change to search_rna_demo.jsonl or search_protein_demo.jsonl as needed

  - id: search_data
    op_name: search
    type: map_batch
    dependencies:
      - read_files
    execution_params:
      replicas: 1
      batch_size: 10
    params:
      data_sources: [ncbi]  # Change to [rnacentral] for RNA or [uniprot] for protein
      ncbi_params:
        email: your_email@example.com  # Required for NCBI
        tool: GraphGen
        use_local_blast: false
        max_concurrent: 5

  - id: chunk_documents
    op_name: chunk
    type: map_batch
    dependencies:
      - search_data
    execution_params:
      replicas: 4
    params:
      chunk_size: 1024  # For text metadata
      chunk_overlap: 100
      sequence_chunk_size: 1000  # For sequence chunks (bp for DNA/RNA, aa for protein)
      sequence_chunk_overlap: 100

  - id: build_kg
    op_name: build_kg
    type: map_batch
    dependencies:
      - chunk_documents
    execution_params:
      replicas: 1
      batch_size: 128

  - id: partition
    op_name: partition
    type: aggregate
    dependencies:
      - build_kg
    params:
      method: ece
      method_params:
        max_units_per_community: 3
        min_units_per_community: 3
        max_tokens_per_community: 10240
        unit_sampling: random

  - id: generate
    op_name: generate
    type: map_batch
    dependencies:
      - partition
    execution_params:
      replicas: 1
      batch_size: 128
    params:
      method: multi_hop
      data_format: ChatML
